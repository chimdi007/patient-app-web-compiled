(()=>{var e={477:()=>{},1061:(e,t,o)=>{"use strict";var r=o(2299),n=o(6665),a=o(5479),s=o(8181),i=o(1087),l=o(3929),d=o(6283),c=o(6773),f=o(5648),u=o(530),p=o(3668);const h=o(7109).default.create({baseURL:"https://v2iot.prescribe.ng/patient"}),g=async()=>[...Array(32)].map((()=>Math.floor(16*Math.random()).toString(16))).join("");var y=o(397);const m=p.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",padding:20,backgroundColor:"#FFA500"},title:{color:"green",fontSize:28,fontWeight:"bold",marginBottom:40},input:{height:50,width:"100%",borderColor:"#ddd",borderWidth:1,borderRadius:10,marginBottom:20,paddingLeft:15,backgroundColor:"#fff",fontSize:16},button:{height:50,width:"100%",backgroundColor:"#008080",borderRadius:10,justifyContent:"center",alignItems:"center",marginTop:20},buttonText:{color:"#fff",fontSize:18,fontWeight:"bold"},errorText:{color:"red",marginBottom:20,fontSize:14},footerText:{color:"#fff",marginTop:30,fontSize:14},footerLink:{color:"green",fontWeight:"bold"}}),x=({navigation:e})=>{const[t,o]=(0,n.useState)("activation"),[r,a]=(0,n.useState)(""),[s,p]=(0,n.useState)(""),[x,b]=(0,n.useState)(""),[j,w]=(0,n.useState)(""),[T,C]=(0,n.useState)(!1),[S,k]=(0,n.useState)(null);return(0,y.jsxs)(l.default,{style:m.container,children:[(0,y.jsx)(d.default,{style:m.title,children:"Account Activation"}),S&&(0,y.jsx)(d.default,{style:m.errorText,children:S}),(0,y.jsx)(c.default,{style:m.input,placeholder:"Private Prescription Number (PPN)",value:r,onChangeText:a,keyboardType:"default",autoCapitalize:"none",textContentType:"username"}),(0,y.jsx)(c.default,{style:m.input,placeholder:"National Identification Number(NIN)",value:s,onChangeText:p,keyboardType:"default",autoCapitalize:"none",textContentType:"username"}),(0,y.jsx)(f.default,{style:m.button,onPress:async()=>{if(r&&s){C(!0),k(null);try{const t=await g(),o=await h.post("/login",{ppn:String(r),nin:String(s),action:"activation",secretKey:t}),{token:n,userData:a}=o.data;a.activationAccountFound&&(await i.default.setItem("userToken",n),await i.default.setItem("secretKey",t),await i.default.setItem("userData",JSON.stringify(a)),e.replace("TOTP"))}catch(t){k(t.response?.data?.message||"An error occurred. Please check your credentials and try again.")}finally{C(!1)}}else k("Enter a valid PPN and NIN.")},disabled:T,children:T?(0,y.jsx)(u.default,{size:"small",color:"#fff"}):(0,y.jsx)(d.default,{style:m.buttonText,children:"Activate Account"})}),(0,y.jsx)(d.default,{style:m.footerText,onPress:()=>e.replace("Login"),children:(0,y.jsx)(d.default,{style:m.footerLink,children:"Back to Login Page"})})]})};var b=o(1217),j=o.n(b);const w=async(e=30,t=6)=>{try{const o=await i.default.getItem("secretKey");if(!o)throw new Error("No secretKey found in AsyncStorage");const r=Math.floor(Date.now()/1e3/e),n=j().enc.Hex.parse(r.toString(16).padStart(16,"0")),a=j().HmacSHA1(n,o).toString(j().enc.Hex),s=parseInt(a.charAt(a.length-1),16),l=2147483647&parseInt(a.substr(2*s,8),16);return(l%Math.pow(10,t)).toString().padStart(t,"0")}catch(o){return console.error("Error generating TOTP:",o),null}},T=p.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",padding:20,backgroundColor:"#FFA500"},title:{color:"green",fontSize:28,fontWeight:"bold",marginBottom:40},input:{height:50,width:"100%",borderColor:"#ddd",borderWidth:1,borderRadius:10,marginBottom:20,paddingLeft:15,backgroundColor:"#fff",fontSize:16},button:{height:50,width:"100%",backgroundColor:"#008080",borderRadius:10,justifyContent:"center",alignItems:"center",marginTop:20},buttonText:{color:"#fff",fontSize:18,fontWeight:"bold"},errorText:{color:"red",marginBottom:20,fontSize:14},footerText:{color:"#fff",marginTop:30,fontSize:14},footerLink:{color:"green",fontWeight:"bold"}}),C=({navigation:e})=>{const[t,o]=(0,n.useState)(""),[r,a]=(0,n.useState)(""),[s,p]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null);return(0,y.jsxs)(l.default,{style:T.container,children:[m&&(0,y.jsx)(d.default,{style:T.errorText,children:m}),(0,y.jsx)(c.default,{style:T.input,placeholder:"Password",secureTextEntry:!0,value:t,onChangeText:o,textContentType:"password"}),(0,y.jsx)(c.default,{style:T.input,placeholder:"Repeat Password",secureTextEntry:!0,value:r,onChangeText:a,textContentType:"password"}),(0,y.jsx)(f.default,{style:T.button,onPress:async()=>{if(t&&r){p(!0),x(null);try{const o=await i.default.getItem("userToken"),n=await g(),a=await w(),s=await h.post("/first_password",{password:t,passwordRepeat:r},{headers:{Authorization:`Bearer ${o}`,secretKey:n,dgotp:a}});if(200===s.status){const{newToken:t,userData:o}=s.data;await i.default.setItem("secretKey",n),await i.default.setItem("userToken",t),await i.default.setItem("userData",JSON.stringify(o)),e.replace("Home")}else x(s.data?.message||"Unexpected response from the server.")}catch(o){x(o.response?.data?.message||"An error occurred. Please check your credentials and try again.")}finally{p(!1)}}else x("Please enter both Private Prescription Number (PPN) and password.")},disabled:s,children:s?(0,y.jsx)(u.default,{size:"small",color:"#fff"}):(0,y.jsx)(d.default,{style:T.buttonText,children:"Set Password"})}),(0,y.jsx)(d.default,{style:T.footerText,onPress:()=>e.replace("Login"),children:(0,y.jsx)(d.default,{style:T.footerLink,children:"Back"})})]})},S=p.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",padding:20,backgroundColor:"#FFA500"},title:{color:"green",fontSize:28,fontWeight:"bold",marginBottom:40},input:{height:50,width:"100%",borderColor:"#ddd",borderWidth:1,borderRadius:10,marginBottom:20,paddingLeft:15,backgroundColor:"#fff",fontSize:16},button:{height:50,width:"100%",backgroundColor:"#008080",borderRadius:10,justifyContent:"center",alignItems:"center",marginTop:20},buttonText:{color:"#fff",fontSize:18,fontWeight:"bold"},errorText:{color:"red",marginBottom:20,fontSize:14},footerText:{color:"#fff",marginTop:30,fontSize:14},footerLink:{color:"green",fontWeight:"bold"}}),k=({navigation:e})=>{const[t,o]=(0,n.useState)(""),[r,a]=(0,n.useState)(""),[s,p]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null);return(0,y.jsxs)(l.default,{style:S.container,children:[(0,y.jsx)(d.default,{style:S.title,children:"PRESCRIBE.NG"}),m&&(0,y.jsx)(d.default,{style:S.errorText,children:m}),(0,y.jsx)(c.default,{style:S.input,placeholder:"Private Prescription Number (PPN)",value:t,onChangeText:o,keyboardType:"default",autoCapitalize:"none",textContentType:"username"}),(0,y.jsx)(c.default,{style:S.input,placeholder:"Password",secureTextEntry:!0,value:r,onChangeText:a,textContentType:"password"}),(0,y.jsx)(f.default,{style:S.button,onPress:async()=>{if(!t||!r)return void x("Please enter both Private Prescription Number (PPN) and password.");p(!0),x(null);const o=await g();try{const n=await h.post("/login",{ppn:String(t),password:String(r),action:"login",secretKey:o});console.log("Response received:",n.data);const{token:a,userData:s}=n.data;await i.default.setItem("userToken",a),await i.default.setItem("secretKey",o),await i.default.setItem("userData",JSON.stringify(s)),e.replace("TOTP")}catch(n){console.error("Error Response:",n.response?.data),x(n.response?.data?.message||"An error occurred. Please check your credentials and try again.")}finally{p(!1)}},disabled:s,children:s?(0,y.jsx)(u.default,{size:"small",color:"#fff"}):(0,y.jsx)(d.default,{style:S.buttonText,children:"Log In"})}),(0,y.jsx)(d.default,{style:S.footerText,onPress:()=>e.replace("PasswordReset"),children:(0,y.jsx)(d.default,{style:S.footerLink,children:"Forgot Password?"})}),(0,y.jsx)(d.default,{style:S.footerText,onPress:()=>e.replace("Activation"),children:(0,y.jsx)(d.default,{style:S.footerLink,children:"Account Activation"})})]})},v=p.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",padding:20,backgroundColor:"#FFA500"},title:{color:"green",fontSize:28,fontWeight:"bold",marginBottom:40},input:{height:50,width:"100%",borderColor:"#ddd",borderWidth:1,borderRadius:10,marginBottom:20,paddingLeft:15,backgroundColor:"#fff",fontSize:16},button:{height:50,width:"100%",backgroundColor:"#008080",borderRadius:10,justifyContent:"center",alignItems:"center",marginTop:20},buttonText:{color:"#fff",fontSize:18,fontWeight:"bold"},errorText:{color:"red",marginBottom:20,fontSize:14},footerText:{color:"#fff",marginTop:30,fontSize:14},footerLink:{color:"green",fontWeight:"bold"}}),P=({navigation:e})=>{const[t,o]=(0,n.useState)(""),[r,a]=(0,n.useState)(!1),[s,p]=(0,n.useState)(null);return(0,y.jsxs)(l.default,{style:v.container,children:[s&&(0,y.jsx)(d.default,{style:v.errorText,children:s}),(0,y.jsx)(c.default,{style:v.input,placeholder:"Enter OTP",value:t,onChangeText:o,keyboardType:"default",autoCapitalize:"none",textContentType:"username"}),(0,y.jsx)(f.default,{style:v.button,onPress:async()=>{if(!t)return void p("Please enter the TOTP.");a(!0),p(null);const o=await i.default.getItem("userToken"),r=await g();if(!o||!r)return p("Authentication token is missing. Please log in again."),void a(!1);const n=await w();try{const a=await h.post("/multifactor_authentication",{totp:String(t)},{headers:{Authorization:`Bearer ${o}`,secretKey:r,dgotp:n}});console.log("Response received:",a.data);const{newToken:s,userData:l}=a.data;await i.default.setItem("secretKey",r),await i.default.setItem("userToken",s),await i.default.setItem("userData",JSON.stringify(l)),"firstPassword"===l.action?e.replace("FirstPassword"):"login"===l.action&&e.replace("Home")}catch(s){console.error("Error Response:",s.response?.data),p(s.response?.data?.message||"An error occurred. Please check the TOTP and try again.")}finally{a(!1)}},disabled:r,children:r?(0,y.jsx)(u.default,{size:"small",color:"#fff"}):(0,y.jsx)(d.default,{style:v.buttonText,children:"Verify OTP"})}),(0,y.jsx)(d.default,{style:v.footerText,onPress:()=>e.replace("Login"),children:(0,y.jsx)(d.default,{style:v.footerLink,children:"Back to Login Page"})})]})};var I=o(637),R=o(2772),B=o(484),D=o(8180),A=o(2660),z=o(9632);const N=async()=>{try{const e=await w();if(!e)return void console.warn("Failed to generate OTP.");const t=await i.default.getItem("userToken");if(!t)return void console.warn("No userToken found. Cannot fetch data.");const o=await h.get("/updated_patient_data",{headers:{Authorization:`Bearer ${t}`,dgotp:e}});if(!o.data||!o.data.userData)return void console.error("Invalid response format:",o.data);console.log("Response received:",o.data);const{userData:r}=o.data;return await i.default.setItem("userData",JSON.stringify(r)),r}catch(e){return console.error("Error during API request:",e),null}},E=p.default.create({container:{flex:1,backgroundColor:"#f7f7f7",marginTop:20,paddingTop:20},profileHeader:{alignItems:"center",padding:20,backgroundColor:"#FFA500",borderBottomLeftRadius:20,borderBottomRightRadius:20,shadowColor:"#000",shadowOffset:{width:0,height:5},shadowOpacity:.3,shadowRadius:10,elevation:8,marginBottom:20,justifyContent:"center"},profileImage:{width:250,height:250,borderRadius:90,borderWidth:3,borderColor:"#fff",marginBottom:10,resizeMode:"cover"},placeholderImage:{width:180,height:180,borderRadius:90,backgroundColor:"#ccc",justifyContent:"center",alignItems:"center",marginBottom:10},placeholderText:{color:"#fff",fontWeight:"bold"},sectionTitle:{fontSize:18,fontWeight:"bold",marginVertical:10},userName:{fontSize:22,fontWeight:"bold",color:"#fff",marginTop:10},profileDetails:{padding:20,backgroundColor:"#fff",borderTopLeftRadius:20,borderTopRightRadius:20,shadowColor:"#000",shadowOffset:{width:0,height:-2},shadowOpacity:.1,shadowRadius:6,elevation:4,marginBottom:20,flex:1},detailText:{fontSize:16,color:"#555",marginBottom:15},bold:{fontWeight:"bold"},logoutContainer:{marginTop:10,padding:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:6,marginBottom:20},policyRow:{flexDirection:"column",justifyContent:"space-between",paddingVertical:6,borderBottomWidth:1,borderColor:"#eee"},policyName:{fontWeight:"600",fontSize:16},policyId:{color:"#666",fontSize:14},noSponsorText:{fontStyle:"italic",color:"#999",marginTop:8}}),O=({navigation:e})=>{const[t,o]=(0,n.useState)({}),[r,a]=(0,n.useState)(!1),s=async()=>{try{const e=await N();if(e)o(e);else{const e=await i.default.getItem("userData"),t=e?JSON.parse(e):{};o(t)}}catch(e){console.error("Error in fetching updated data:",e)}};(0,n.useEffect)((()=>{s()}),[]);const c=(0,n.useCallback)((()=>{s()}),[]);return(0,y.jsxs)(R.default,{style:E.container,refreshControl:(0,y.jsx)(A.default,{refreshing:r,onRefresh:c}),children:[(0,y.jsxs)(l.default,{style:E.profileHeader,children:[t?.photoUrl?(0,y.jsx)(B.default,{source:{uri:t.photoUrl},style:E.profileImage}):(0,y.jsx)(l.default,{style:E.placeholderImage,children:(0,y.jsx)(d.default,{style:E.placeholderText,children:"No Image"})}),(0,y.jsx)(d.default,{style:E.userName,children:t?.user||"Guest"})]}),(0,y.jsxs)(l.default,{style:E.profileDetails,children:[(0,y.jsxs)(d.default,{style:E.detailText,children:[(0,y.jsx)(d.default,{style:E.bold,children:"PPN: "}),t?.ppn||"Not found"]}),(0,y.jsxs)(d.default,{style:E.detailText,children:[(0,y.jsx)(d.default,{style:E.bold,children:"Gender: "}),t?.gender||"Not found"," (",t?.age,"yrs)"]}),(0,y.jsxs)(d.default,{style:E.detailText,children:[(0,y.jsx)(d.default,{style:E.bold,children:"DOB: "}),t?.dob||"Not found"," (",t?.age,"yrs)"]}),(0,y.jsxs)(d.default,{style:E.detailText,children:[(0,y.jsx)(d.default,{style:E.bold,children:"Address: "}),t?.address||"Not found"]}),(0,y.jsxs)(d.default,{style:E.detailText,children:[(0,y.jsx)(d.default,{style:E.bold,children:"Credit: "}),"\u20a6",t?.credit||0]})]}),(0,y.jsxs)(l.default,{style:E.profileDetails,children:[(0,y.jsx)(d.default,{style:E.sectionTitle,children:"Sponsors/HMO: "}),t?.policies?.length>0?t.policies.map(((e,t)=>(0,y.jsxs)(l.default,{style:E.policyRow,children:[(0,y.jsx)(d.default,{style:E.policyName,children:e.sponsor.toUpperCase()}),(0,y.jsxs)(d.default,{style:E.policyId,children:["Plan: ",e.plan,"(",e.policyNumber,")"]}),(0,y.jsxs)(d.default,{style:E.policyId,children:["Contact: ",e.contact]})]},t))):(0,y.jsx)(d.default,{style:E.noSponsorText,children:"No sponsor info available"})]}),(0,y.jsx)(l.default,{style:E.logoutContainer,children:(0,y.jsx)(D.default,{title:"Find HMO",onPress:async()=>{const e="https://prescribe.ng/";await z.default.canOpenURL(e)?await z.default.openURL(e):Alert.alert(`Don't know how to open this URL: ${e}`)},color:"#008080"})}),(0,y.jsx)(l.default,{style:E.logoutContainer,children:(0,y.jsx)(D.default,{title:"Logout",onPress:async()=>{await i.default.removeItem("userToken"),await i.default.removeItem("userData"),e.replace("Login")},color:"#FF6F00"})})]})};var L=o(932),F=o(1690),W=o(6903);const U=p.default.create({container:{marginTop:50,flex:1,padding:20,backgroundColor:"#f9f9f9"},prescriptionRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:15,marginVertical:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:3},prescriptionInfo:{flex:1,marginRight:10},infoText:{fontSize:14,color:"#333"},pharmacyRow:{padding:15,marginVertical:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:3},sectionTitle:{fontSize:18,fontWeight:"bold",marginVertical:10},emptyText:{textAlign:"center",fontSize:16,color:"#999",marginTop:20},logoutButton:{marginTop:20}}),V=({navigation:e})=>{const[t,o]=(0,n.useState)({}),[r,a]=(0,n.useState)([]),[s,c]=(0,n.useState)(null),[f,u]=(0,n.useState)([]),[p,g]=(0,n.useState)(!1),[m,x]=(0,n.useState)(!1),b=async()=>{try{const e=await N();if(e)o(e),a(e.prescriptions||[]);else{const e=await i.default.getItem("userData"),t=e?JSON.parse(e):{};o(t),a(t.prescriptions||[])}}catch(e){console.error("Error in fetching updated data:",e)}};(0,n.useEffect)((()=>{b()}),[]);const j=(0,n.useCallback)((()=>{b()}),[]);return(0,y.jsxs)(l.default,{style:U.container,children:[!p&&(0,y.jsx)(L.default,{data:r,keyExtractor:(e,t)=>t.toString(),renderItem:({item:e})=>(0,y.jsxs)(l.default,{style:U.prescriptionRow,children:[(0,y.jsxs)(l.default,{style:U.prescriptionInfo,children:[(0,y.jsxs)(d.default,{style:U.infoText,children:["Prescription: ",e.prescription]}),(0,y.jsxs)(d.default,{style:U.infoText,children:["Source: ",e.source]}),(0,y.jsxs)(d.default,{style:U.infoText,children:["Date: ",e.date]}),(0,y.jsxs)(d.default,{style:U.infoText,children:["Status: ",e.status]}),(0,y.jsxs)(d.default,{style:U.infoText,children:["Service Pin: ",e.servicePin]})]}),(0,y.jsx)(D.default,{title:"Locate Item",color:"#008080",onPress:()=>(async e=>{try{const{status:t}=await W.requestForegroundPermissionsAsync();if("granted"!==t)return void F.default.alert("Permission Denied","Location access is required.");const o=await W.getCurrentPositionAsync({});if(!o||!o.coords)return void F.default.alert("Location Error","Unable to fetch location.");const r=await i.default.getItem("userToken");if(!r)return void F.default.alert("Error","User not authenticated.");const n=await w(),a=await h.get(`/locate_prescription_item?sku=${e}&latitude=${o.coords.latitude}&longitude=${o.coords.longitude}`,{headers:{Authorization:`Bearer ${r}`,dgotp:n}});200===a.status?(u(a.data.pharmacies||[]),g(!0)):F.default.alert("Error","Failed to fetch pharmacies.")}catch(t){console.error("Error locating prescription:",t),F.default.alert("Error","An unexpected error occurred.")}})(e.sku)})]}),ListEmptyComponent:(0,y.jsx)(d.default,{style:U.emptyText,children:"No prescriptions found."}),refreshControl:(0,y.jsx)(A.default,{refreshing:m,onRefresh:j})}),p&&(0,y.jsxs)(l.default,{children:[(0,y.jsx)(d.default,{style:U.sectionTitle,children:"Nearby Pharmacies"}),(0,y.jsx)(L.default,{data:f,keyExtractor:(e,t)=>t.toString(),renderItem:({item:e})=>(0,y.jsxs)(l.default,{style:U.pharmacyRow,children:[(0,y.jsxs)(d.default,{style:U.infoText,children:["Pharmacy: ",e.pharmacy]}),(0,y.jsxs)(d.default,{style:U.infoText,children:["Brand: ",e.proprietaryName]}),(0,y.jsxs)(d.default,{style:U.infoText,children:["Unit Price: ",e.unitPrice]}),(0,y.jsxs)(d.default,{style:U.infoText,children:["Location: ",e.address]}),(0,y.jsxs)(d.default,{style:U.infoText,children:["Distance: ",e.distance]})]})}),(0,y.jsx)(D.default,{title:"Back to Prescriptions",onPress:()=>{g(!1),u([])},color:"#ff4444"})]})]})};var $=o(7366),_=o(8264),H=o(4079);function M({visible:e,qrValue:t,onClose:o}){return(0,y.jsx)(_.default,{visible:e,transparent:!0,animationType:"fade",children:(0,y.jsx)(l.default,{style:q.modalBackground,children:(0,y.jsxs)(l.default,{style:q.modalContainer,children:[(0,y.jsx)(d.default,{style:q.title,children:"Scan Appointment QR"}),(0,y.jsx)(H.default,{value:t,size:200}),(0,y.jsx)(f.default,{onPress:o,style:q.closeButton,children:(0,y.jsx)(d.default,{style:q.closeButtonText,children:"Close"})})]})})})}const q=p.default.create({modalBackground:{flex:1,backgroundColor:"rgba(0,0,0,0.6)",justifyContent:"center",alignItems:"center"},modalContainer:{backgroundColor:"white",padding:20,borderRadius:12,alignItems:"center"},title:{fontSize:18,marginBottom:20},closeButton:{marginTop:20,backgroundColor:"#ddd",padding:10,borderRadius:6},closeButtonText:{fontWeight:"600"}}),J=p.default.create({container:{flex:1,padding:20,backgroundColor:"#f5f5f5"},pickerContainer:{alignContent:"center",justifyItems:"center",justifyContent:"center",borderWidth:1,borderColor:"#ccc",borderRadius:8,marginVertical:10,backgroundColor:"#fff",paddingHorizontal:10,overflow:"hidden"},picker:{height:80,width:"100%",marginBottom:50},appointmentDisplay:{marginTop:50},bookingForm:{backgroundColor:"#fff",padding:20,marginTop:20,borderRadius:10,elevation:5,flexDirection:"column",justifyContent:"space-between",paddingBottom:20},formTitle:{fontSize:20,fontWeight:"bold",marginBottom:15,textAlign:"center",color:"#333"},input:{height:45,borderColor:"#ddd",borderWidth:1,borderRadius:8,marginBottom:15,paddingHorizontal:10,backgroundColor:"#f7f7f7"},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},button:{width:"48%"},appointmentRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:15,padding:10,backgroundColor:"#fff",borderRadius:8,elevation:3},appointmentInfo:{flex:1},infoText:{fontSize:16,color:"#555"},emptyText:{fontSize:16,color:"#999",textAlign:"center",marginTop:20}}),K=(p.default.create({container:{padding:10,backgroundColor:"#f5f5f5"},pickerContainer:{borderWidth:1,borderColor:"#ccc",borderRadius:8,marginVertical:12,backgroundColor:"#fff"},picker:{height:50,width:"100%"},appointmentDisplay:{marginTop:50},bookingForm:{backgroundColor:"#fff",padding:20,marginTop:20,borderRadius:10,elevation:5},formTitle:{fontSize:20,fontWeight:"bold",marginBottom:15,textAlign:"center",color:"#333"},input:{height:45,borderColor:"#ddd",borderWidth:1,borderRadius:8,marginBottom:15,paddingHorizontal:10,backgroundColor:"#f7f7f7"},buttonContainer:{flexDirection:"row",justifyContent:"space-between"},button:{width:"48%"},appointmentRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginBottom:15,padding:10,backgroundColor:"#fff",borderRadius:8,elevation:3},appointmentInfo:{flex:1},infoText:{fontSize:16,color:"#555"},emptyText:{fontSize:16,color:"#999",textAlign:"center",marginTop:20}}),({navigation:e})=>{const[t,o]=(0,n.useState)({}),[r,a]=(0,n.useState)([]),[s,f]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),[g,m]=(0,n.useState)(""),[x,b]=(0,n.useState)(!1),[j,T]=(0,n.useState)({searchQuery:"",appointmentType:"",destinationID:"",localBranchID:"",localConfigID:"",ppn:""}),[C,S]=(0,n.useState)("Cancelled by patient"),[k,v]=(t.user,t.ppn,(0,n.useState)([]));(0,n.useEffect)((()=>{(async()=>{try{const{status:e}=await W.requestForegroundPermissionsAsync();if("granted"!==e)return void F.default.alert("Permission Denied","Location access is required.");const t=await W.getCurrentPositionAsync({});t&&t.coords||F.default.alert("Location Error","Unable to fetch location.");const o=await w(),r=await i.default.getItem("userToken"),n=await h.get(`/search_destinations?appointmentType=${encodeURIComponent(j.appointmentType)}&q=${j.searchQuery}&latitude=${t.coords.latitude}&longitude=${t.coords.longitude}`,{headers:{Authorization:`Bearer ${r}`,dgotp:o}}),{destinationOptions:a}=n.data;v(a)}catch(e){console.error("Error Response:",e.response?.data),setError(e.response?.data?.message||"An error occurred. Please check your credentials and try again.")}})()}),[t?.token,j.appointmentType,j.searchQuery]);const P=async()=>{try{const e=await N();if(e)o(e),a(e.appointments||[]);else{const e=await i.default.getItem("userData"),t=e?JSON.parse(e):{};o(t),a(t.appointments||[])}}catch(e){console.error("Error fetching updated data:",e)}};(0,n.useEffect)((()=>{P()}),[x]);const I=(0,n.useCallback)((()=>{P()}),[]);return(0,y.jsxs)(l.default,{style:J.container,children:[!s&&(0,y.jsxs)(l.default,{children:[(0,y.jsx)(l.default,{style:J.appointmentDisplay,children:(0,y.jsx)(L.default,{data:r,keyExtractor:e=>e?.ticketID.toString(),renderItem:({item:e})=>(0,y.jsxs)(l.default,{style:J.appointmentRow,children:[(0,y.jsxs)(l.default,{style:J.appointmentInfo,children:[(0,y.jsxs)(d.default,{style:J.infoText,children:["Appointment: ",e.nonproprietaryName.toUpperCase()]}),(0,y.jsxs)(d.default,{style:J.infoText,children:["Location: ",e.location]}),(0,y.jsxs)(d.default,{style:J.infoText,children:["Status: ",e.appointmentStatus]}),(0,y.jsxs)(d.default,{style:J.infoText,children:["Service Pin: ",e.servicePin]})]}),(0,y.jsxs)(l.default,{children:[(0,y.jsx)(D.default,{title:"Cancel",color:"#ff4444",onPress:()=>(async e=>{await i.default.getItem("userToken")?t?.ppn?C?F.default.alert("Confirm Cancellation","Appointment cancellation is irreversible. Do you want to proceed?",[{text:"Cancel",onPress:()=>console.log("Cancellation aborted"),style:"cancel"},{text:"Confirm",onPress:async()=>{try{const o=await i.default.getItem("userToken");if(!o)return void F.default.alert("Error","User not authenticated.");const r=await w(),n=await h.post("/cancel_appointment",{ppn:t.ppn,sku:e.sku,ticketID:e.ticketID,cancellationReason:C},{headers:{Authorization:`Bearer ${o}`,dgotp:r}}),{message:a}=n.data;F.default.alert("Message",a),P(),f(!1)}catch(o){console.error("Error canceling appointment:",o),F.default.alert("Error",o.response?.data?.message||o.message||"An unexpected error occurred.")}}}],{cancelable:!1}):F.default.alert("Error","Please provide a cancellation reason."):F.default.alert("Error","No dependant selected."):F.default.alert("Error","User not authenticated.")})(e)}),(0,y.jsx)(D.default,{title:"QR Code",color:"#4CAF50",onPress:()=>{return t=e.referenceID,m(t),void p(!0);var t}}),(0,y.jsx)(M,{visible:u,qrValue:g,onClose:()=>p(!1)})]})]}),ListEmptyComponent:(0,y.jsx)(d.default,{style:J.emptyText,children:"No appointments found."}),refreshControl:(0,y.jsx)(A.default,{refreshing:x,onRefresh:I})})}),(0,y.jsx)(D.default,{title:"Book New Appointment",onPress:()=>f(!0),color:"#008080"})]}),s&&(0,y.jsxs)(l.default,{style:J.bookingForm,children:[(0,y.jsx)(d.default,{style:J.formTitle,children:"Book a New Appointment"}),(0,y.jsx)(l.default,{style:J.pickerContainer,children:(0,y.jsxs)($.Picker,{selectedValue:j.appointmentType,onValueChange:e=>T(Object.assign({},j,{appointmentType:e})),style:J.picker,children:[(0,y.jsx)($.Picker.Item,{label:"Select Appointment Type",value:""}),[{label:"General Outpatient Appointment",nonproprietaryName:"general outpatient consultation"},{label:"Dental Clinic Appointment",nonproprietaryName:"general dental consultation"},{label:"Eye Clinic Consultation",nonproprietaryName:"general ophthalmology consultation"},{label:"Physiotherapy Clinic",nonproprietaryName:"general physiotherapy session"}].map((e=>(0,y.jsx)($.Picker.Item,{label:e.label,value:e.nonproprietaryName},e.value)))]})}),(0,y.jsx)(l.default,{style:J.pickerContainer,children:(0,y.jsxs)($.Picker,{selectedValue:j.localConfigID||"",onValueChange:e=>{const t=k.find((t=>t.localConfigID===e));T(t?Object.assign({},j,{localConfigID:t.localConfigID,localBranchID:t.localBranchID,destinationID:t.destinationID}):Object.assign({},j,{localConfigID:"",localBranchID:"",destinationID:""}))},style:J.picker,children:[(0,y.jsx)($.Picker.Item,{label:"Select Destination",value:""}),k.map(((e,t)=>(0,y.jsx)($.Picker.Item,{label:e.destination,value:e.localConfigID},t)))]})}),(0,y.jsx)(c.default,{style:J.input,placeholder:"Search destination...",value:j.searchQuery,onChangeText:e=>T(Object.assign({},j,{searchQuery:e}))}),(0,y.jsx)(l.default,{style:J.pickerContainer,children:(0,y.jsxs)($.Picker,{selectedValue:j.ppn,onValueChange:e=>T(Object.assign({},j,{ppn:e})),style:J.picker,children:[(0,y.jsx)($.Picker.Item,{label:"Select a patient",value:""}),(0,y.jsx)($.Picker.Item,{label:t.user,value:t.ppn}),t?.dependants.map((e=>(0,y.jsx)($.Picker.Item,{label:e.user,value:e.ppn},e.value)))]})}),(0,y.jsxs)(l.default,{style:J.buttonContainer,children:[(0,y.jsx)(l.default,{style:J.button,children:(0,y.jsx)(D.default,{title:"Book Appointment",onPress:async()=>{const{ppn:e,appointmentType:t,destinationID:o,localBranchID:r,localConfigID:n}=j;t&&o&&r&&n?e?F.default.alert("Confirm Submission","Do you want to submit the appointment request?",[{text:"Cancel",onPress:()=>console.log("Submission cancelled"),style:"cancel"},{text:"Confirm",onPress:async()=>{try{const a=await i.default.getItem("userToken");if(!a)return void F.default.alert("Error","User not authenticated.");const s=await w(),l=await h.post("/book_appointment",{ppn:e,appointmentType:t,destinationID:o,localBranchID:r,localConfigID:n},{headers:{Authorization:`Bearer ${a}`,dgotp:s}}),{message:d}=await l.data;F.default.alert("Success",d),v([]),f(!1),P()}catch(a){console.error("Error booking appointment:",a),a.response&&a.response.data&&a.response.data.message?F.default.alert("Error",a.response.data.message):F.default.alert("Error","An unexpected error occurred.")}}}],{cancelable:!1}):F.default.alert("Error","No patient selected."):F.default.alert("Error","All fields are required to book an appointment.")},color:"#008080"})}),(0,y.jsx)(l.default,{style:J.button,children:(0,y.jsx)(D.default,{title:"Cancel",onPress:()=>f(!1),color:"#ff4444"})})]})]})]})});var Q=o(231),G=o(8876),X=o(6931);const Y=p.default.create({container:{marginTop:50,flex:1,padding:20,backgroundColor:"#f9f9f9"},prescriptionRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:15,marginVertical:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:3},prescriptionInfo:{flex:1,marginRight:10},infoText:{fontSize:14,color:"#333"},pharmacyRow:{padding:15,marginVertical:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:3},sectionTitle:{fontSize:18,fontWeight:"bold",marginVertical:10},emptyText:{textAlign:"center",fontSize:16,color:"#999",marginTop:20},logoutButton:{marginTop:20}}),Z=({navigation:e})=>{const[t,o]=(0,n.useState)({}),[r,a]=(0,n.useState)([]),[s,c]=(0,n.useState)(!1),f=async()=>{try{const e=await N();if(e)o(e),a(e.correspondence||[]);else{const e=await i.default.getItem("userData"),t=e?JSON.parse(e):{};o(t),a(t.correspondence||[])}}catch(e){console.error("Error in fetching updated data:",e)}};(0,n.useEffect)((()=>{f()}),[]);const u=(0,n.useCallback)((()=>{f()}),[]);return(0,y.jsx)(l.default,{style:Y.container,children:(0,y.jsx)(L.default,{data:r,keyExtractor:(e,t)=>t.toString(),renderItem:({item:e})=>(0,y.jsxs)(l.default,{style:Y.prescriptionRow,children:[(0,y.jsxs)(l.default,{style:Y.prescriptionInfo,children:[(0,y.jsxs)(d.default,{style:Y.infoText,children:["Title: ",e.noteTitle]}),(0,y.jsxs)(d.default,{style:Y.infoText,children:["Source: ",e.source]}),(0,y.jsxs)(d.default,{style:Y.infoText,children:["Issued On: ",e.issuedOn]})]}),(0,y.jsx)(D.default,{title:"Download",color:"#008080",onPress:()=>(async e=>{try{const t=await i.default.getItem("userToken");if(!t)return void F.default.alert("Error","User not authenticated.");const o=await w(),r=await h.get(`/download_correspondence?correspondenceReference=${e}`,{headers:{Authorization:`Bearer ${t}`,dgotp:o},responseType:"arraybuffer"});if(200===r.status){const t=btoa(new Uint8Array(r.data).reduce(((e,t)=>e+String.fromCharCode(t)),"")),o=Q.documentDirectory+`Correspondence_${e}.pdf`;await Q.writeAsStringAsync(o,t,{encoding:G.EncodingType.Base64}),await X.isAvailableAsync()?await X.shareAsync(o):F.default.alert("Success","PDF file has been downloaded successfully!")}else F.default.alert("Error","Failed to download correspondence letter.")}catch(t){console.error("Error during correspondence download:",t),F.default.alert("Error","An unexpected error occurred.")}})(e.correspondenceReference)})]}),ListEmptyComponent:(0,y.jsx)(d.default,{style:Y.emptyText,children:"No correspondence found."}),refreshControl:(0,y.jsx)(A.default,{refreshing:s,onRefresh:u})})})},ee=p.default.create({page:{flex:1,padding:20,backgroundColor:"#f9f9f9"},container:{marginTop:50,flex:1,padding:20,backgroundColor:"#f9f9f9"},prescriptionRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:15,marginVertical:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:3},prescriptionInfo:{flex:1,marginRight:10},infoText:{fontSize:14,color:"#333"},pharmacyRow:{padding:15,marginVertical:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:3},sectionTitle:{fontSize:18,fontWeight:"bold",marginVertical:10},emptyText:{textAlign:"center",fontSize:16,color:"#999",marginTop:20},logoutButton:{marginTop:20},profileHeader:{alignItems:"center",padding:20,backgroundColor:"#FFA500",borderBottomLeftRadius:20,borderBottomRightRadius:20,shadowColor:"#000",shadowOffset:{width:0,height:5},shadowOpacity:.3,shadowRadius:10,elevation:8,marginBottom:20,justifyContent:"center"},profileImage:{width:250,height:250,borderRadius:90,borderWidth:3,borderColor:"#fff",marginBottom:10,resizeMode:"cover"},placeholderImage:{width:180,height:180,borderRadius:90,backgroundColor:"#ccc",justifyContent:"center",alignItems:"center",marginBottom:10},placeholderText:{color:"#fff",fontWeight:"bold"},userName:{fontSize:22,fontWeight:"bold",color:"#fff",marginTop:10},profileDetails:{padding:20,backgroundColor:"#fff",borderTopLeftRadius:20,borderTopRightRadius:20,shadowColor:"#000",shadowOffset:{width:0,height:-2},shadowOpacity:.1,shadowRadius:6,elevation:4,marginBottom:20,flex:1},detailText:{fontSize:16,color:"#555",marginBottom:15},sectionTitle:{fontSize:20,fontWeight:"bold",marginBottom:15,textAlign:"center",color:"#333"},bold:{fontWeight:"bold"},logoutContainer:{marginTop:20,padding:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:6,marginBottom:20},prescriptionRow:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:15,marginVertical:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:3},prescriptionInfo:{flex:1,marginRight:10},infoText:{fontSize:14,color:"#333"},pharmacyRow:{padding:15,marginVertical:10,backgroundColor:"#fff",borderRadius:10,shadowColor:"#000",shadowOffset:{width:0,height:2},shadowOpacity:.2,shadowRadius:4,elevation:3},policyRow:{flexDirection:"column",justifyContent:"space-between",paddingVertical:6,borderBottomWidth:1,borderColor:"#eee"},policyName:{fontWeight:"600",fontSize:16},policyId:{color:"#666",fontSize:14},noSponsorText:{fontStyle:"italic",color:"#999",marginTop:8}}),te=({navigation:e})=>{const[t,o]=(0,n.useState)({}),[r,a]=(0,n.useState)("dependantsList"),[s,c]=(0,n.useState)("prescriptions"),[f,u]=(0,n.useState)([]),[p,g]=(0,n.useState)(!1),[m,x]=(0,n.useState)(null),[b,j]=(0,n.useState)([]),[T,C]=(0,n.useState)(`Cancelled by watcher: ${t.user}`),[S,k]=(0,n.useState)(!1),[v,P]=(0,n.useState)(!1),[I,z]=(0,n.useState)(""),E=async()=>{try{const e=await N();if(e){o(e),u(e.dependants||[]);const t=f.find((e=>e.ppn===m?.ppn));t&&x(t)}else{const e=await i.default.getItem("userData"),t=e?JSON.parse(e):{};o(t),u(t.dependants||[])}}catch(e){console.error("Error in fetching updated data:",e)}};(0,n.useEffect)((()=>{E()}),[]);const O=(0,n.useCallback)((()=>{E()}),[]),U=async e=>{try{const t=await i.default.getItem("userToken");if(!t)return void F.default.alert("Error","User not authenticated.");const o=await w(),r=await h.get(`/download_correspondence?correspondenceReference=${e}`,{headers:{Authorization:`Bearer ${t}`,dgotp:o},responseType:"arraybuffer"});if(200===r.status){const t=btoa(new Uint8Array(r.data).reduce(((e,t)=>e+String.fromCharCode(t)),"")),o=Q.documentDirectory+`Correspondence_${e}.pdf`;await Q.writeAsStringAsync(o,t,{encoding:G.EncodingType.Base64}),await X.isAvailableAsync()?await X.shareAsync(o):F.default.alert("Success","PDF file has been downloaded successfully!")}else F.default.alert("Error","Failed to download correspondence letter.")}catch(t){console.error("Error during correspondence download:",t),F.default.alert("Error","An unexpected error occurred.")}};return(0,y.jsxs)(l.default,{style:ee.page,children:["dependantsList"==r&&(0,y.jsx)(l.default,{style:ee.container,children:(0,y.jsx)(L.default,{data:f,keyExtractor:(e,t)=>t.toString(),renderItem:({item:e})=>(0,y.jsxs)(l.default,{style:ee.prescriptionRow,children:[(0,y.jsxs)(l.default,{style:ee.prescriptionInfo,children:[(0,y.jsxs)(d.default,{style:ee.infoText,children:["Dependant: ",e.user]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["PPN: ",e.ppn]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["DOB: ",e.dob," (",e.age,")"]})]}),(0,y.jsx)(D.default,{title:"Open",color:"#008080",onPress:()=>(async e=>{x(e),a("dependant")})(e)})]}),ListEmptyComponent:(0,y.jsx)(d.default,{style:ee.emptyText,children:"No dependants found."}),refreshControl:(0,y.jsx)(A.default,{refreshing:p,onRefresh:O})})}),"dependant"==r&&(0,y.jsxs)(R.default,{style:ee.container,refreshControl:(0,y.jsx)(A.default,{refreshing:p,onRefresh:O}),children:[(0,y.jsxs)(l.default,{style:ee.profileHeader,children:[t?.photoUrl?(0,y.jsx)(B.default,{source:{uri:m.photoUrl},style:ee.profileImage}):(0,y.jsx)(l.default,{style:ee.placeholderImage,children:(0,y.jsx)(d.default,{style:ee.placeholderText,children:"No Image"})}),(0,y.jsx)(d.default,{style:ee.userName,children:m?.user||"Guest"})]}),(0,y.jsxs)(l.default,{style:ee.profileDetails,children:[(0,y.jsxs)(d.default,{style:ee.detailText,children:[(0,y.jsx)(d.default,{style:ee.bold,children:"PPN: "}),m?.ppn||"Not found"]}),(0,y.jsxs)(d.default,{style:ee.detailText,children:[(0,y.jsx)(d.default,{style:ee.bold,children:"Gender: "}),m?.gender||"Not found"," (",m?.age,"yrs)"]}),(0,y.jsxs)(d.default,{style:ee.detailText,children:[(0,y.jsx)(d.default,{style:ee.bold,children:"DOB: "}),m?.dob||"Not found"," (",m?.age,"yrs)"]}),(0,y.jsxs)(d.default,{style:ee.detailText,children:[(0,y.jsx)(d.default,{style:ee.bold,children:"Address: "}),m?.address||"Not found"]}),(0,y.jsxs)(d.default,{style:ee.detailText,children:[(0,y.jsx)(d.default,{style:ee.bold,children:"Credit: "}),"\u20a6",m?.credit||0]})]}),(0,y.jsxs)(l.default,{style:ee.profileDetails,children:[(0,y.jsx)(d.default,{style:ee.sectionTitle,children:"Sponsors/HMO:  "}),m?.policies?.length>0?m.policies.map(((e,t)=>(0,y.jsxs)(l.default,{style:ee.policyRow,children:[(0,y.jsx)(d.default,{style:ee.policyName,children:e.sponsor.toUpperCase()}),(0,y.jsxs)(d.default,{style:ee.policyId,children:["Plan: ",e.plan,"(",e.policyNumber,")"]}),(0,y.jsxs)(d.default,{style:ee.policyId,children:["Contact: ",e.contact]})]},t))):(0,y.jsx)(d.default,{style:ee.noSponsorText,children:"No sponsor info available"})]}),(0,y.jsxs)(l.default,{style:ee.profileDetails,children:[(0,y.jsx)(d.default,{style:ee.sectionTitle,children:"Prescriptions"}),"prescriptions"===s&&(0,y.jsx)(L.default,{data:m?.prescriptions,keyExtractor:(e,t)=>t.toString(),renderItem:({item:e})=>(0,y.jsxs)(l.default,{style:ee.prescriptionRow,children:[(0,y.jsxs)(l.default,{style:ee.prescriptionInfo,children:[(0,y.jsxs)(d.default,{style:ee.infoText,children:["Prescription: ",e.prescription]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Source: ",e.source]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Date: ",e.date]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Status: ",e.status]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Service Pin: ",e.servicePin]})]}),(0,y.jsx)(D.default,{title:"Locate Item",color:"#008080",onPress:()=>{(async e=>{try{const{status:t}=await W.requestForegroundPermissionsAsync();if("granted"!==t)return void F.default.alert("Permission Denied","Location access is required.");const o=await W.getCurrentPositionAsync({});if(!o||!o.coords)return void F.default.alert("Location Error","Unable to fetch location.");const r=await i.default.getItem("userToken");if(!r)return void F.default.alert("Error","User not authenticated.");const n=await w(),a=await h.get(`/locate_prescription_item?sku=${e}&latitude=${o.coords.latitude}&longitude=${o.coords.longitude}`,{headers:{Authorization:`Bearer ${r}`,dgotp:n}});200===a.status?(j(a.data.pharmacies||[]),k(!0)):F.default.alert("Error","Failed to fetch pharmacies.")}catch(t){console.error("Error locating prescription:",t),F.default.alert("Error","An unexpected error occurred.")}})(e.sku),c("itemLocation")}})]}),ListEmptyComponent:(0,y.jsx)(d.default,{style:ee.emptyText,children:"No prescriptions found."}),refreshControl:(0,y.jsx)(A.default,{refreshing:p,onRefresh:O})}),"itemLocation"===s&&(0,y.jsxs)(l.default,{children:[(0,y.jsx)(L.default,{data:b,keyExtractor:(e,t)=>t.toString(),renderItem:({item:e})=>(0,y.jsxs)(l.default,{style:ee.pharmacyRow,children:[(0,y.jsxs)(d.default,{style:ee.infoText,children:["Pharmacy: ",e.pharmacy]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Brand: ",e.proprietaryName]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Unit Price: ",e.unitPrice]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Location: ",e.address]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Distance: ",e.distance]})]}),ListEmptyComponent:(0,y.jsx)(d.default,{style:ee.emptyText,children:"No prescriptions found."}),refreshControl:(0,y.jsx)(A.default,{refreshing:p,onRefresh:O})}),(0,y.jsx)(D.default,{title:"Back to prescriptions",color:"#ff4444",onPress:()=>{c("prescriptions"),j([])}})]})]}),(0,y.jsxs)(l.default,{style:ee.profileDetails,children:[(0,y.jsx)(d.default,{style:ee.sectionTitle,children:"Appointments"}),(0,y.jsx)(L.default,{data:m?.appointments,keyExtractor:e=>e?.ticketID.toString(),renderItem:({item:e})=>(0,y.jsxs)(l.default,{style:ee.appointmentRow,children:[(0,y.jsxs)(l.default,{style:ee.appointmentInfo,children:[(0,y.jsxs)(d.default,{style:ee.infoText,children:["Appointment: ",e.nonproprietaryName.toUpperCase()]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Location: ",e.location]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Status: ",e.appointmentStatus]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Service Pin: ",e.servicePin]})]}),(0,y.jsxs)(l.default,{children:[(0,y.jsx)(D.default,{title:"Cancel",color:"#ff4444",onPress:()=>(async e=>{await i.default.getItem("userToken")?m?.ppn?T?F.default.alert("Confirm Cancellation","Appointment cancellation is irreversible. Do you want to proceed?",[{text:"Cancel",onPress:()=>console.log("Cancellation aborted"),style:"cancel"},{text:"Confirm",onPress:async()=>{try{const t=await i.default.getItem("userToken");if(!t)return void F.default.alert("Error","User not authenticated.");const o=await w(),r=await h.post("/cancel_appointment",{ppn:m.ppn,sku:e.sku,ticketID:e.ticketID,cancellationReason:T},{headers:{Authorization:`Bearer ${t}`,dgotp:o}}),{message:n}=r.data;F.default.alert("Message",n),E()}catch(t){console.error("Error canceling appointment:",t),F.default.alert("Error",t.response?.data?.message||t.message||"An unexpected error occurred.")}}}],{cancelable:!1}):F.default.alert("Error","Please provide a cancellation reason."):F.default.alert("Error","No dependant selected."):F.default.alert("Error","User not authenticated.")})(e)}),(0,y.jsx)(D.default,{title:"QR Code",color:"#4CAF50",onPress:()=>{return t=e.referenceID,z(t),void P(!0);var t}}),(0,y.jsx)(M,{visible:v,qrValue:I,onClose:()=>P(!1)})]})]}),ListEmptyComponent:(0,y.jsx)(d.default,{style:ee.emptyText,children:"No appointments found."}),refreshControl:(0,y.jsx)(A.default,{refreshing:p,onRefresh:O})})]}),(0,y.jsxs)(l.default,{style:ee.profileDetails,children:[(0,y.jsx)(d.default,{style:ee.sectionTitle,children:"Correspondence"}),(0,y.jsx)(L.default,{data:m?.correspondence,keyExtractor:(e,t)=>t.toString(),renderItem:({item:e})=>(0,y.jsxs)(l.default,{style:ee.prescriptionRow,children:[(0,y.jsxs)(l.default,{style:ee.prescriptionInfo,children:[(0,y.jsxs)(d.default,{style:ee.infoText,children:["Title: ",e.noteTitle]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Source: ",e.source]}),(0,y.jsxs)(d.default,{style:ee.infoText,children:["Issued On: ",e.issuedOn]})]}),(0,y.jsx)(D.default,{title:"Download",color:"#008080",onPress:()=>U(e.correspondenceReference)})]}),ListEmptyComponent:(0,y.jsx)(d.default,{style:ee.emptyText,children:"No correspondence found."}),refreshControl:(0,y.jsx)(A.default,{refreshing:p,onRefresh:O})})]}),(0,y.jsx)(l.default,{style:ee.logoutContainer,children:(0,y.jsx)(D.default,{title:"Close",onPress:()=>{x({}),a("dependantsList")},color:"#FF6F00"})})]})]})};var oe=o(3359);const re=(0,I.createBottomTabNavigator)(),ne=p.default.create({headerStyle:{backgroundColor:"#FF6F00"},headerTitleStyle:{fontWeight:"bold",fontSize:20},tabBarStyle:{height:60},tabBarLabelStyle:{fontSize:14,fontWeight:"bold",color:"white",backgroundColor:"#FF6F00"}}),ae=()=>(0,y.jsxs)(re.Navigator,{initialRouteName:"Profile",screenOptions:{headerShown:!1,tabBarActiveTintColor:"#FF6F00",tabBarInactiveTintColor:"gray"},children:[(0,y.jsx)(re.Screen,{style:ne.title,name:"Profile",component:O,options:{tabBarIcon:({color:e,size:t})=>(0,y.jsx)(oe.default,{name:"user",size:t,color:e})}}),(0,y.jsx)(re.Screen,{name:"Appointments",component:K,options:{tabBarIcon:({color:e,size:t})=>(0,y.jsx)(oe.default,{name:"calendar",size:t,color:e})}}),(0,y.jsx)(re.Screen,{name:"Correspondence",component:Z,options:{tabBarIcon:({color:e,size:t})=>(0,y.jsx)(oe.default,{name:"file-text-o",size:t,color:e})}}),(0,y.jsx)(re.Screen,{name:"Dependants",component:te,options:{tabBarIcon:({color:e,size:t})=>(0,y.jsx)(oe.default,{name:"child",size:t,color:e})}}),(0,y.jsx)(re.Screen,{name:"Prescriptions",component:V,options:{tabBarIcon:({color:e,size:t})=>(0,y.jsx)(oe.default,{name:"medkit",size:t,color:e})}})]}),se=({navigation:e})=>(0,y.jsx)(ae,{navigation:e}),ie=p.default.create({container:{flex:1,justifyContent:"center",alignItems:"center",padding:20,backgroundColor:"#FFA500"},title:{color:"green",fontSize:28,fontWeight:"bold",marginBottom:40},input:{height:50,width:"100%",borderColor:"#ddd",borderWidth:1,borderRadius:10,marginBottom:20,paddingLeft:15,backgroundColor:"#fff",fontSize:16},button:{height:50,width:"100%",backgroundColor:"#008080",borderRadius:10,justifyContent:"center",alignItems:"center",marginTop:20},buttonText:{color:"#fff",fontSize:18,fontWeight:"bold"},errorText:{color:"red",marginBottom:20,fontSize:14},footerText:{color:"#fff",marginTop:30,fontSize:14},footerLink:{color:"green",fontWeight:"bold"}}),le=({navigation:e})=>{const[t,o]=(0,n.useState)("activation"),[r,a]=(0,n.useState)(""),[s,i]=(0,n.useState)(""),[p,m]=(0,n.useState)(""),[x,b]=(0,n.useState)(""),[j,w]=(0,n.useState)(!1),[T,C]=(0,n.useState)(null);return(0,y.jsxs)(l.default,{style:ie.container,children:[(0,y.jsx)(d.default,{style:ie.title,children:"Password Reset"}),T&&(0,y.jsx)(d.default,{style:ie.errorText,children:T}),(0,y.jsx)(c.default,{style:ie.input,placeholder:"Private Prescription Number (PPN)",value:r,onChangeText:a,keyboardType:"default",autoCapitalize:"none",textContentType:"username"}),(0,y.jsx)(f.default,{style:ie.button,onPress:async()=>{if(r){w(!0),C(null);try{await g(),await h.post("/generate_password_reset_link",{ppn:String(r)})}catch(e){C(e.response?.data?.message||"An error occurred. Please check your credentials and try again.")}finally{w(!1)}}else C("Enter a valid PPN.")},disabled:j,children:j?(0,y.jsx)(u.default,{size:"small",color:"#fff"}):(0,y.jsx)(d.default,{style:ie.buttonText,children:"Reset Password"})}),(0,y.jsx)(d.default,{style:ie.footerText,onPress:()=>e.replace("Login"),children:(0,y.jsx)(d.default,{style:ie.footerLink,children:"Back to Login Page"})})]})},de=(0,s.createStackNavigator)();(0,r.default)((function(){const[e,t]=(0,n.useState)(null);return(0,n.useEffect)((()=>{(async()=>{const e=await i.default.getItem("userToken"),o=await i.default.getItem("userData"),r=JSON.parse(o);t(!(!e||"login"!==r?.action||"valid"!==r?.tokenValidity))})()}),[]),null===e?null:(0,y.jsx)(a.NavigationContainer,{children:e?(0,y.jsxs)(de.Navigator,{screenOptions:{headerShown:!1},children:[(0,y.jsx)(de.Screen,{name:"Home",component:se}),(0,y.jsx)(de.Screen,{name:"Login",component:k}),(0,y.jsx)(de.Screen,{name:"TOTP",component:P}),(0,y.jsx)(de.Screen,{name:"Activation",component:x}),(0,y.jsx)(de.Screen,{name:"FirstPassword",component:C}),(0,y.jsx)(de.Screen,{name:"PasswordReset",component:le})]}):(0,y.jsxs)(de.Navigator,{screenOptions:{headerShown:!1},children:[(0,y.jsx)(de.Screen,{name:"Login",component:k}),(0,y.jsx)(de.Screen,{name:"TOTP",component:P}),(0,y.jsx)(de.Screen,{name:"Home",component:se}),(0,y.jsx)(de.Screen,{name:"Activation",component:x}),(0,y.jsx)(de.Screen,{name:"FirstPassword",component:C}),(0,y.jsx)(de.Screen,{name:"PasswordReset",component:le})]})})}))}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r].call(a.exports,a,a.exports,o),a.exports}o.m=e,(()=>{var e=[];o.O=(t,r,n,a)=>{if(!r){var s=1/0;for(c=0;c<e.length;c++){for(var[r,n,a]=e[c],i=!0,l=0;l<r.length;l++)(!1&a||s>=a)&&Object.keys(o.O).every((e=>o.O[e](r[l])))?r.splice(l--,1):(i=!1,a<s&&(s=a));if(i){e.splice(c--,1);var d=n();void 0!==d&&(t=d)}}return t}a=a||0;for(var c=e.length;c>0&&e[c-1][2]>a;c--)e[c]=e[c-1];e[c]=[r,n,a]}})(),o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="/",(()=>{var e={792:0};o.O.j=t=>0===e[t];var t=(t,r)=>{var n,a,[s,i,l]=r,d=0;if(s.some((t=>0!==e[t]))){for(n in i)o.o(i,n)&&(o.m[n]=i[n]);if(l)var c=l(o)}for(t&&t(r);d<s.length;d++)a=s[d],o.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return o.O(c)},r=self.webpackChunkweb=self.webpackChunkweb||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=o.O(void 0,[672],(()=>o(1061)));r=o.O(r)})();
//# sourceMappingURL=main.b9b0cd16.js.map